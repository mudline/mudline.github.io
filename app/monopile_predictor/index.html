<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#43313F"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>海上风电单桩数据快速评估工具 | SigmaTau</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">

  <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.19.0/js/md5.min.js"></script>

  <style>
    body {
      font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, "Microsoft YaHei", sans-serif;
      background: #f8f9fa;
      color: #34495e;
    }

    header {
      height: 30vh;
      background: linear-gradient(135deg,#3a3f51,#5b5f73);
    }

    .tool-card {
      margin-top: -120px;
      margin-bottom: 80px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.12);
      padding: 40px;
    }

    h2 {
      text-align: center;
      font-weight: 600;
      margin-bottom: 30px;
      color: #2c3e50;
    }

    label {
      font-weight: 600;
      font-size: 14px;
      color: #6c757d;
    }

    /* ✅ 修复 select 文字被裁切问题 */
    .form-control {
      height: calc(1.5em + 0.75rem + 2px);
      padding: 0.375rem 0.75rem !important;
      font-size: 14px;
      line-height: 1.5;
      border-radius: 8px;
    }

    input.form-control {
      padding: 0.5rem 0.75rem !important;
    }

    input[readonly] {
      background: #f1f3f5;
      font-weight: bold;
      color: #1e3a8a;
    }

    .btn-primary {
      border-radius: 8px;
      padding: 12px;
      font-weight: bold;
      box-shadow: 0 6px 12px rgba(30,58,138,0.25);
    }

    .result-group {
      margin-top: 30px;
      padding-top: 25px;
      border-top: 2px dashed #e9ecef;
    }

    .info-group {
      margin-top: 25px;
      padding: 15px;
      background: #f8f9fa;
      border-left: 4px solid #f59e0b;
      border-radius: 6px;
      font-size: 13px;
    }

    .error {
      color: #dc3545;
      font-weight: bold;
      margin-top: 10px;
      display: none;
      text-align: center;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
</head>

<body>

<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/"><strong>SigmaTau</strong></a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ml-auto text-center">
        <li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li>
        <!-- <li class="nav-item"><a class="nav-link" href="#"><i class="iconfont icon-archive-fill"></i> 汇总</a></li> -->
        <!-- <li class="nav-item"><a class="nav-link" href="#"><i class="iconfont icon-category-fill"></i> 分类</a></li> -->
        <!-- <li class="nav-item"><a class="nav-link" href="#"><i class="iconfont icon-tags-fill"></i> 标签</a></li> -->
        <!-- <li class="nav-item"><a class="nav-link" href="#"><i class="iconfont icon-user-fill"></i> 关于</a></li> -->
      </ul>
    </div>
  </div>
</nav>

<header></header>

<main class="container">
  <div class="col-lg-8 mx-auto tool-card">

    <h2>海上风电单桩数据快速评估工具</h2>

    <div class="form-group">
      <label>省份 (Province)</label>
      <select id="province" class="form-control">
        <option>模型初始化中...</option>
      </select>
    </div>

    <div class="form-group"><label>离岸距离 (km)</label><input type="number" id="distance" class="form-control"></div>
    <div class="form-group"><label>单机容量 (MW)</label><input type="number" id="capacity" class="form-control"></div>
    <div class="form-group"><label>场址水深 (m)</label><input type="number" id="depth" class="form-control"></div>
    <div class="form-group"><label>授权密码</label><input type="password" id="password" class="form-control"></div>

    <button id="predictBtn" class="btn btn-primary btn-block" onclick="runPrediction()">预测</button>
    <div id="errorMsg" class="error"></div>

    <div class="result-group">
      <div class="form-group"><label>单桩重量预测 (t)</label><input id="res_weight" class="form-control" readonly></div>
      <div class="form-group"><label>顶部直径 (m)</label><input id="res_top_diameter" class="form-control" readonly></div>
      <div class="form-group"><label>底部直径 (m)</label><input id="res_bottom_diameter" class="form-control" readonly></div>
      <div class="form-group"><label>总桩长 (m)</label><input id="res_total_length" class="form-control" readonly></div>
      <div class="form-group"><label>附属构件重量 (t)</label><input id="res_accessory_weight" class="form-control" readonly></div>
    </div>

    <div class="info-group">
      <strong>有关说明：</strong><br>
      1. 模型基于 Log-GBDT 架构。<br>
      2. 仅用于前期快速估算。<br>
      3. 单机容量：5.2MW~18.0MW。<br>
      4. 水深：8m~40m。<br>
      5. 离岸距离：10km~85km。<br>
      6. 含套笼、靠船、爬梯、平台等附属构件。<br>
      7. 数据样本量：233 组。
    </div>

  </div>
</main>



<script>
  let session = null;
  let provinceMap = [];
  
  async function init() {
    try {
      const resp = await fetch('./provinces.json');
      provinceMap = await resp.json();
      const sel = document.getElementById('province');
      sel.innerHTML = '';
      provinceMap.forEach((p, index) => {
        const opt = document.createElement('option');
        opt.value = index; 
        opt.text = p;
        sel.appendChild(opt);
      });
      session = await ort.InferenceSession.create('./model.onnx');
    } catch (e) {
      console.error(e);
      document.getElementById('errorMsg').innerText = "系统就绪失败，请联系管理员检查模型资源";
      document.getElementById('errorMsg').style.display = 'block';
    }
  }
  
  async function runPrediction() {
    const btn = document.getElementById('predictBtn');
    const errDiv = document.getElementById('errorMsg');
    const pwd = document.getElementById('password').value;
  
    // 获取所有输出元素
    const outWeight = document.getElementById('res_weight');
    const outTopDiameter = document.getElementById('res_top_diameter');
    const outBottomDiameter = document.getElementById('res_bottom_diameter');
    const outTotalLength = document.getElementById('res_total_length');
    const outAccessoryWeight = document.getElementById('res_accessory_weight');
  
    if (pwd !== '106') {
      outWeight.value = 'password error!';
      outTopDiameter.value = 'password error!';
      outBottomDiameter.value = 'password error!';
      outTotalLength.value = 'password error!';
      outAccessoryWeight.value = 'password error!';
      return;
    }
  
    const p_code = parseFloat(document.getElementById('province').value);
    const dist = parseFloat(document.getElementById('distance').value);
    const cap = parseFloat(document.getElementById('capacity').value);
    const depth = parseFloat(document.getElementById('depth').value);
  
    if (isNaN(dist) || dist <= 0 || isNaN(cap) || cap <= 0 || isNaN(depth) || depth <= 0) {
      alert("请核对输入参数，确保所有数值为正数！");
      return;
    }
  
    if (!session) return;
  
    try {
      btn.disabled = true;
      btn.innerText = "引擎处理中...";
      
      const inputData = Float32Array.from([p_code, dist, cap, depth]);
      const tensor = new ort.Tensor('float32', inputData, [1, 4]);
      const results = await session.run({ float_input: tensor });
      const output = results.variable.data; 
  
      // 处理5个输出值
      const weight = Math.max(0, Math.expm1(output[0]));
      const topDiameter = Math.max(0, Math.expm1(output[1]));
      const bottomDiameter = Math.max(0, Math.expm1(output[2]));
      const totalLength = Math.max(0, Math.expm1(output[3]));
      const accessoryWeight = Math.max(0, Math.expm1(output[4]));
  
      // 格式化并显示结果
      const formatOptions = {minimumFractionDigits: 2, maximumFractionDigits: 2};
      
      outWeight.value = weight.toLocaleString(undefined, formatOptions);
      outTopDiameter.value = topDiameter.toLocaleString(undefined, formatOptions);
      outBottomDiameter.value = bottomDiameter.toLocaleString(undefined, formatOptions);
      outTotalLength.value = totalLength.toLocaleString(undefined, formatOptions);
      outAccessoryWeight.value = accessoryWeight.toLocaleString(undefined, formatOptions);
  
    } catch (e) {
      console.error(e);
      alert("计算引擎发生异常");
    } finally {
      btn.disabled = false;
      btn.innerText = "预测";
    }
  }
  
  window.onload = init;
</script>



</body>
</html>
